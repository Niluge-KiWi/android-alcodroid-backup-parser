Parser for backup files for [AlcoDroid Alcohol Tracker](https://play.google.com/store/apps/details?id=org.M.alcodroid) Android App.

(More specifically backups generated by [last version 2.37.04](https://apkpure.com/alcodroid-alcohol-tracker/org.M.alcodroid/download/2.37.04), no effort was done to support older backups, but it could be implemented, cf `TODO` comments in code.)

# Usage
## Install

(from Archlinux)

Depedencies:
(`caterpillar` requires python 3.12+, I install it with `pyenv`)
```shell
yay -S pyenv
pyenv version
pyenv install --list
pyenv install 3.12

eval "$(pyenv init -)" # in ~/.bashrc

yay -S poetry
```

## Run
show:
```shell
poetry run python android_alcodroid_backup_parser/main.py show /path/to/all_data.backup
```

extract journal entries as jsonlines format:
```
poetry run python android_alcodroid_backup_parser/main.py extract-entries /path/to/all_data.backup  /path/to/all_data.backup.entries.jsonl
```

Remarks:
- `caterpillar` dependecy is still beta and installed via git HEAD; I used https://github.com/MatrixEditor/caterpillar/commit/c4bf1d23050091ebff5632f17024fbed3a8bcf0b version.



# Development
## Reverse Engineering
The binary format is not a standard format: `file` says `data`.
`strings` shows names of my entries: no compression, no encryption: yay!

I then went the `apk` decompilation way. I am a total beginning at that: I just followed some random blog posts and ended up using [jadx-gui](https://github.com/skylot/jadx).

What I did with `jadx`: exploring code & concepts from some naming (settings, UI, localization strings) and app user knowledge and some tests; pivoting back and forth with search for variables/functions usages, definitions, renaming variables along the way.

Remarks:
- my naming is not consistent: sometime my own, sometimes app author one, depending on how I found the meaning of things first
- no guarantee that the semantic is correct (but the types should be)
- didn't try to be exhaustive: just parse my backup files.

## Parsing
[Caterpillar](https://matrixeditor.github.io/caterpillar/) python struct parser seemed nice.

Remarks:
- my `DateField` class may not be the recommended way to augment Fields class, I didn't find clear doc about extensions: let me know if you know better!
- it's optimized for development and exploration, notably `rich` `print` is really slow, but helpful when iterating!
